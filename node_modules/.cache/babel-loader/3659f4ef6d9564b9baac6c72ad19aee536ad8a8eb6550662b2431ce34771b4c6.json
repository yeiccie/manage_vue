{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nrequire(\"core-js/modules/es.array.for-each.js\");\nrequire(\"core-js/modules/es.array.join.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.splice.js\");\nrequire(\"core-js/modules/es.function.name.js\");\nrequire(\"core-js/modules/es.iterator.constructor.js\");\nrequire(\"core-js/modules/es.iterator.for-each.js\");\nrequire(\"core-js/modules/es.number.constructor.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/es.string.starts-with.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nvar _vue = require(\"vue\");\nvar _default = exports[\"default\"] = {\n  __name: 'upload',\n  props: {\n    action: String,\n    limit: {\n      type: Number,\n      \"default\": 3\n    },\n    multiple: {\n      type: Boolean,\n      \"default\": false\n    },\n    fileUrls: String,\n    tip: {\n      type: String,\n      \"default\": '请上传'\n    },\n    type: {\n      type: String,\n      \"default\": 'img'\n    },\n    disabled: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  emits: ['change'],\n  setup: function setup(__props, _ref) {\n    var _getCurrentInstance;\n    var __expose = _ref.expose,\n      __emit = _ref.emit;\n    __expose();\n    var context = (_getCurrentInstance = (0, _vue.getCurrentInstance)()) === null || _getCurrentInstance === void 0 ? void 0 : _getCurrentInstance.appContext.config.globalProperties;\n    var emit = __emit;\n    //props\n    var props = __props;\n    //data\n    var tips = (0, _vue.ref)('请上传');\n    var uploadUrl = (0, _vue.ref)('');\n    var fileList = (0, _vue.ref)([]);\n    var fileUrlList = (0, _vue.ref)([]);\n    var _toRefs = (0, _vue.toRefs)(props),\n      action = _toRefs.action,\n      fileUrls = _toRefs.fileUrls,\n      limit = _toRefs.limit,\n      multiple = _toRefs.multiple,\n      tip = _toRefs.tip,\n      type = _toRefs.type,\n      disabled = _toRefs.disabled;\n    var dialogImageUrl = (0, _vue.ref)('');\n    var dialogVisible = (0, _vue.ref)(false);\n    var uploadHeaders = (0, _vue.ref)({});\n    (0, _vue.watch)(fileUrls, function () {\n      init();\n    });\n    // // methods\n\n    //移除\n    var handleRemove = function handleRemove(e) {\n      fileUrlList.value.splice(e.uid - 1, 1);\n      fileUrlsChange(fileUrlList.value);\n      emit('change', fileUrlList.value.join(','));\n    };\n    //查看图片\n    var handlePictureCardPreview = function handlePictureCardPreview(e) {\n      dialogImageUrl.value = e.url;\n      dialogVisible.value = true;\n    };\n    //成功回调\n    var uploadSuccess = function uploadSuccess(e, file, fileList) {\n      fileUrlList.value.push(\"file/\" + e.file);\n      fileUrlsChange(fileUrlList.value);\n      emit('change', fileUrlList.value.join(','));\n    };\n    var uploadError = function uploadError(e) {\n      context === null || context === void 0 || context.$toolUtil.message('上传失败', 'error');\n    };\n    var uploadPreview = function uploadPreview(e) {\n      window.open(e.url);\n    };\n    //处理上传图片\n    var fileUrlsChange = function fileUrlsChange(list) {\n      var token = context === null || context === void 0 ? void 0 : context.$toolUtil.storageGet(\"token\");\n      var list1 = [];\n      var list2 = [];\n      list.forEach(function (item, index) {\n        var url = item.split(\"?\")[0];\n        var url1 = '';\n        if (!url.startsWith(\"http\")) {\n          url1 = (context === null || context === void 0 ? void 0 : context.$config.url) + url;\n        }\n        var name = index + 1;\n        var file = {\n          name: name,\n          url: url1 + \"?token=\" + token,\n          uid: index + 1\n        };\n        list1.push(file);\n        list2.push(url);\n      });\n      fileList.value = list1;\n      fileUrlList.value = list2;\n    };\n    //超出数量\n    var uploadExceed = function uploadExceed() {\n      context === null || context === void 0 || context.$toolUtil.message(\"\\u6700\\u591A\\u4E0A\\u4F20\".concat(limit.value, \"\\u4E2A\\u6587\\u4EF6\"), 'error');\n    };\n    //created\n    var init = function init() {\n      uploadUrl.value = (context === null || context === void 0 ? void 0 : context.$config.name) + '/' + action.value;\n      uploadHeaders.value = {\n        'Token': context === null || context === void 0 ? void 0 : context.$toolUtil.storageGet(\"Token\")\n      };\n      if (tip.value) {\n        tips.value = tip.value;\n      }\n      var list = [];\n      if (fileUrls.value) {\n        list = fileUrls.value.split(',');\n      }\n      fileUrlsChange(list);\n    };\n    init();\n    var __returned__ = {\n      context: context,\n      emit: emit,\n      props: props,\n      tips: tips,\n      uploadUrl: uploadUrl,\n      fileList: fileList,\n      fileUrlList: fileUrlList,\n      action: action,\n      fileUrls: fileUrls,\n      limit: limit,\n      multiple: multiple,\n      tip: tip,\n      type: type,\n      disabled: disabled,\n      dialogImageUrl: dialogImageUrl,\n      dialogVisible: dialogVisible,\n      uploadHeaders: uploadHeaders,\n      handleRemove: handleRemove,\n      handlePictureCardPreview: handlePictureCardPreview,\n      uploadSuccess: uploadSuccess,\n      uploadError: uploadError,\n      uploadPreview: uploadPreview,\n      fileUrlsChange: fileUrlsChange,\n      uploadExceed: uploadExceed,\n      init: init,\n      ref: _vue.ref,\n      getCurrentInstance: _vue.getCurrentInstance,\n      toRefs: _vue.toRefs,\n      watch: _vue.watch\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["_vue","require","_default","exports","context","_getCurrentInstance","getCurrentInstance","appContext","config","globalProperties","emit","__emit","props","__props","tips","ref","uploadUrl","fileList","fileUrlList","_toRefs","toRefs","action","fileUrls","limit","multiple","tip","type","disabled","dialogImageUrl","dialogVisible","uploadHeaders","watch","init","handleRemove","e","value","splice","uid","fileUrlsChange","join","handlePictureCardPreview","url","uploadSuccess","file","push","uploadError","$toolUtil","message","uploadPreview","window","open","list","token","storageGet","list1","list2","forEach","item","index","split","url1","startsWith","$config","name","uploadExceed","concat"],"sources":["/Users/yeiccie/Documents/work_space/second-hand-mall/manage_code/src/components/common/upload.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<el-upload v-if=\"type=='img'\" class=\"img-uploader\" :action=\"uploadUrl\" list-type=\"picture-card\" :limit=\"limit\" :multiple=\"multiple\"\r\n\t\t\tv-model:file-list=\"fileList\" :on-success=\"uploadSuccess\" :on-exceed=\"uploadExceed\" :disabled=\"disabled\"\r\n\t\t\t:headers=\"uploadHeaders\" accept=\"image/*\">\r\n\t\t\t<el-icon>\r\n\t\t\t\t<Plus />\r\n\t\t\t</el-icon>\r\n\t\t\t<template #file=\"{ file }\">\r\n\t\t\t\t<div style=\"width: 100%;height: 100%;\">\r\n\t\t\t\t\t<img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" style=\"object-fit: cover;\" />\r\n\t\t\t\t\t<span class=\"el-upload-list__item-actions\">\r\n\t\t\t\t\t\t<span class=\"el-upload-list__item-preview\" @click=\"handlePictureCardPreview(file)\">\r\n\t\t\t\t\t\t\t<el-icon>\r\n\t\t\t\t\t\t\t\t<zoom-in />\r\n\t\t\t\t\t\t\t</el-icon>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<span v-if=\"!disabled\" class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n\t\t\t\t\t\t\t<el-icon>\r\n\t\t\t\t\t\t\t\t<Delete />\r\n\t\t\t\t\t\t\t</el-icon>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t\t<template #tip v-if=\"!disabled\">\r\n\t\t\t\t<div class=\"el-upload__tip\">\r\n\t\t\t\t\t{{tips}}\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t</el-upload>\r\n\t\t<el-upload v-else class=\"upload-demo\" drag :action=\"uploadUrl\" :headers=\"uploadHeaders\" :limit=\"limit\"\r\n\t\t\t:multiple=\"multiple\" v-model:file-list=\"fileList\" :on-preview=\"uploadPreview\" multiple\r\n\t\t\t:on-success=\"uploadSuccess\" :on-error=\"uploadError\" :on-exceed=\"uploadExceed\" :on-remove=\"handleRemove\" :disabled=\"disabled\">\r\n\t\t\t<el-icon class=\"el-icon--upload\">\r\n\t\t\t\t<upload-filled />\r\n\t\t\t</el-icon>\r\n\t\t\t<div class=\"el-upload__text\">\r\n\t\t\t\t将文件拖到此处，或<em>点击上传</em>\r\n\t\t\t</div>\r\n\t\t\t<template #tip>\r\n\t\t\t\t<div class=\"el-upload__tip\">\r\n\t\t\t\t\t{{tips}}\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t</el-upload>\r\n\t\t<el-dialog v-model=\"dialogVisible\" width=\"60%\">\r\n\t\t\t<img w-full :src=\"dialogImageUrl\" alt=\"Preview Image\" style=\"width: 100%;\" />\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tgetCurrentInstance,\r\n\t\ttoRefs,\r\n\t\tdefineEmits,\r\n\t\twatch\r\n\t} from 'vue'\r\n\tconst context = getCurrentInstance()?.appContext.config.globalProperties;\r\n\tconst emit = defineEmits(['change'])\r\n\t//props\r\n\tconst props = defineProps({\r\n\t\taction: String,\r\n\t\tlimit: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 3\r\n\t\t},\r\n\t\tmultiple: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tfileUrls: String,\r\n\t\ttip: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '请上传'\r\n\t\t},\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'img'\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t})\r\n\t//data\r\n\tconst tips = ref('请上传')\r\n\tconst uploadUrl = ref('')\r\n\tconst fileList = ref([])\r\n\tconst fileUrlList = ref([])\r\n\tconst {\r\n\t\taction,\r\n\t\tfileUrls,\r\n\t\tlimit,\r\n\t\tmultiple,\r\n\t\ttip,\r\n\t\ttype,\r\n\t\tdisabled\r\n\t} = toRefs(props)\r\n\tconst dialogImageUrl = ref('')\r\n\tconst dialogVisible = ref(false)\r\n\tconst uploadHeaders = ref({})\r\n\r\n\twatch(fileUrls, () => {\r\n\t\tinit()\r\n\t})\r\n\t// // methods\r\n\r\n\t//移除\r\n\tconst handleRemove = (e) => {\r\n\t\tfileUrlList.value.splice(e.uid - 1, 1)\r\n\t\tfileUrlsChange(fileUrlList.value)\r\n\t\temit('change', fileUrlList.value.join(','))\r\n\t}\r\n\t//查看图片\r\n\tconst handlePictureCardPreview = (e) => {\r\n\t\tdialogImageUrl.value = e.url\r\n\t\tdialogVisible.value = true\r\n\t}\r\n\t//成功回调\r\n\tconst uploadSuccess = (e, file, fileList) => {\r\n\t\tfileUrlList.value.push(\"file/\" + e.file)\r\n\t\tfileUrlsChange(fileUrlList.value)\r\n\t\temit('change', fileUrlList.value.join(','))\r\n\t}\r\n\tconst uploadError = (e) => {\r\n\t\tcontext?.$toolUtil.message('上传失败', 'error')\r\n\t}\r\n\tconst uploadPreview = (e) => {\r\n\t\twindow.open(e.url)\r\n\t}\r\n\t//处理上传图片\r\n\tconst fileUrlsChange = (list) => {\r\n\t\tvar token = context?.$toolUtil.storageGet(\"token\");\r\n\t\tvar list1 = []\r\n\t\tvar list2 = []\r\n\t\tlist.forEach(function(item, index) {\r\n\t\t\tvar url = item.split(\"?\")[0];\r\n\t\t\tvar url1 = ''\r\n\t\t\tif (!url.startsWith(\"http\")) {\r\n\t\t\t\turl1 = context?.$config.url + url\r\n\t\t\t}\r\n\t\t\tvar name = index + 1;\r\n\t\t\tvar file = {\r\n\t\t\t\tname: name,\r\n\t\t\t\turl: url1 + \"?token=\" + token,\r\n\t\t\t\tuid: index + 1\r\n\t\t\t};\r\n\t\t\tlist1.push(file);\r\n\t\t\tlist2.push(url);\r\n\t\t});\r\n\t\tfileList.value = list1;\r\n\t\tfileUrlList.value = list2;\r\n\t}\r\n\t//超出数量\r\n\tconst uploadExceed = () => {\r\n\t\tcontext?.$toolUtil.message(`最多上传${limit.value}个文件`, 'error')\r\n\t}\r\n\t//created\r\n\tconst init = () => {\r\n\t\tuploadUrl.value = context?.$config.name + '/' + action.value\r\n\t\tuploadHeaders.value = {\r\n\t\t\t'Token': context?.$toolUtil.storageGet(\"Token\")\r\n\t\t}\r\n\t\tif (tip.value) {\r\n\t\t\ttips.value = tip.value\r\n\t\t}\r\n\t\tlet list = []\r\n\t\tif (fileUrls.value) {\r\n\t\t\tlist = fileUrls.value.split(',')\r\n\t\t}\r\n\t\tfileUrlsChange(list)\r\n\t}\r\n\tinit()\r\n</script>\r\n\r\n<style>\r\n\t.el-upload__tip {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: flex-start;\r\n\t}\r\n\t.el-upload-list.is-disabled .el-upload--picture-card{\r\n\t\tdisplay: none;\r\n\t}\r\n\t.el-upload-list__item-actions {\r\n\t\t--color: #fff;\r\n\t}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}